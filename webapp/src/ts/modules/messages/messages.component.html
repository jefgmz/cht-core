<mm-tool-bar title="Messages">
  <mm-messages-more-menu (exportMessages)="exportMessages()" [conversations]="conversations"></mm-messages-more-menu>
</mm-tool-bar>

<div class="inner">
  <div class="inbox page">

    <div id="message-list" class="col-sm-4 inbox-items left-pane">
      <div class="items-container">
        @if (!loading) {
          <ul>
            @for (msg of conversations; track listTrackBy($index, msg)) {
              <li class="content-row"
                [attr.test-id]="msg.key"
            [ngClass]="{
              'unread': !msg.read,
              'selected': msg.selected
            }"
                >
                <a [routerLink]="['/', 'messages', msg.type + ':' + msg.key]">
                  <div class="content">
                    <div class="heading">
                      <h4>{{msg.contact || msg.from || ('messages.unknown.sender' | translate)}}</h4>
                      <div class="date"><span [innerHTML]="msg.date | relativeDate"></span></div>
                    </div>
                    <div class="summary"><p>{{ msg.message }}</p></div>
                    @if (msg.lineage && msg.lineage.length) {
                      <div class="detail" [innerHTML]="msg.lineage | lineage"></div>
                    }
                  </div>
                </a>
              </li>
            }
          </ul>
        }

        @if (error) {
          <p class="alert alert-danger" role="alert">{{'Error fetching messages' | translate}}</p>
        }
        @if (!error && !loading && !conversations.length) {
          <p class="loading-status">{{'No messages found' | translate}}</p>
        }
        @if (!error && !loading && conversations.length) {
          <p class="loading-status">{{'message.list.complete' | translate}}</p>
        }
        @if (loading) {
          <div class="loader"></div>
        }
        <div class="padding"></div>
      </div>
      <mm-fast-action-button class="mobile-only"
        [config]="{ button: { type: buttonType.FAB } }"
        [fastActions]="fastActionList">
      </mm-fast-action-button>

      <mm-fast-action-button class="desktop-only"
        [config]="{ button: { type: buttonType.FLAT } }"
        [fastActions]="fastActionList">
      </mm-fast-action-button>
    </div>

    <router-outlet></router-outlet>
  </div>
</div>
